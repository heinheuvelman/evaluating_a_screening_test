[{"name":"app.R","content":"library(shiny)\r\nlibrary(bslib)\r\n\r\nui <- \r\n  page_sidebar(\r\n  title = \"Evaluating the performance of a screening test in a population of N=10,000\", \r\n  sidebar = sidebar(\r\n    sliderInput(\r\n      \"prev\", \"Disease prevalence\", 1, 99, 20\r\n    ),\r\n    sliderInput(\r\n      \"sens\", \"Test sensitivity (%)\", 1, 99, 80 \r\n    ), \r\n    sliderInput(\r\n      \"spec\", \"Test specificity (%)\", 1, 99, 80 \r\n    )  \r\n  ),\r\n  page_fluid(  \r\n    plotOutput(\"stackedbar\"),\r\n    layout_columns(\r\n      card(\"Number of people without disease:\",\r\n           textOutput(\"withoutdis\"), style = \"font-size:15px\"),\r\n      card(\"Number of people with disease:\", \r\n           textOutput(\"withdis\"), style = \"font-size:15px\")\r\n    ),\r\n    layout_columns(\r\n      card(\"False positive screening test results:\",\r\n      textOutput(\"falsepos\"), style = \"font-size:15px; background-color:#ffc8c9\"),\r\n      card(\"False negative screening test results:\", \r\n      textOutput(\"falseneg\"), style = \"font-size:15px; background-color:#ffc8c9\")\r\n    ),\r\n    layout_columns(\r\n      card(\"True negative screening test results:\",\r\n           textOutput(\"trueneg\"), style = \"font-size:15px; background-color:#a8e4a0\"),\r\n      card(\"True positive screening test results:\", \r\n           textOutput(\"truepos\"), style = \"font-size:15px; background-color:#a8e4a0\")\r\n    ),\r\n    layout_columns(\r\n      card(\"Negative predictive value (%):\",\r\n           textOutput(\"npv\"), style = \"font-size:15px\"),\r\n      card(\"Positive predictive value (%):\", \r\n           textOutput(\"ppv\"), style = \"font-size:15px\"), \r\n      card(\"Test accuracy (%):\", \r\n           textOutput(\"accuracy\"), style = \"font-size:15px\")\r\n    ),\r\n))\r\n\r\nserver <- function(input, output) {\r\n  output$stackedbar <- renderPlot({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- print(table(data$status, data$screen))\r\n    spec <- print(round(restab[1,1] / (restab[1,1] + restab[1,2]) *100), digits=1)\r\n    sens <- print(round(restab[2,2] / (restab[2,1] + restab[2,2]) *100), digits=1)\r\n    ppv <- print(round(restab[2,2] / (restab[1,2] + restab[2,2]) *100), digits=1)\r\n    npv <- print(round(restab[1,1] / (restab[1,1] + restab[2,1]) *100), digits=1)\r\n    restab <- print(table(data$status, data$screen))\r\n    frequencies <- matrix(c(restab[1,1], restab[1,2], restab[2,2], restab[2,1]), byrow = FALSE, ncol=2)\r\n    colnames(frequencies) <- c(\"Does not have disease\", \"Has disease\")\r\n    rownames(frequencies) <- c(\"True screening\", \"False screening\")\r\n    frequencies\r\n    barplot(frequencies, ylim = c(0,10000), col = c(\"darkgreen\", \"darkred\"), legend.text = c(\"True screening\", \"False screening\"), border=\"white\", xlab=\"group\")\r\n  })\r\n  output$ppv <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    round(100*(restab[2,2] / (restab[2,2] + restab[1,2])), digits=1)\r\n    })\r\n  output$npv <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    round(100*(restab[1,1] / (restab[1,1] + restab[2,1])), digits=1)\r\n  })\r\n  output$truepos <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    restab[2,2]\r\n  })\r\n  output$trueneg <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    restab[1,1]\r\n  })\r\n  output$falsepos <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    restab[1,2]\r\n  })\r\n  output$falseneg <- renderText({\r\n    x <- seq(from = 1, to = 10000, by = 1)\r\n    status <- as.numeric(cut(x,c(0,10000-(100*input$prev),10000), labels = FALSE))\r\n    status[status==1] <- 0\r\n    status[status==2] <- 1\r\n    table(status)\r\n    rm(x)\r\n    data <- as.data.frame(status)\r\n    data$x <- NA\r\n    data$x[data$status==0] <- seq(from = 1, to = length(data$status[data$status==0]), by = 1)\r\n    data$x[data$status==1] <- seq(from = 1, to = length(data$status[data$status==1]), by = 1)\r\n    data$screen <- NA\r\n    data$screen[data$status==0 & data$x < (input$spec)/100 * length(data$x[data$status==0])] <- 0\r\n    data$screen[data$status==0 & data$x >= (input$spec)/100 * length(data$x[data$status==0])] <- 1\r\n    data$screen[data$status==1 & data$x > (input$sens)/100 *length(data$x[data$status==1])] <- 0\r\n    data$screen[data$status==1 & data$x <= (input$sens)/100 * length(data$x[data$status==1])] <- 1\r\n    data <- data[ , c(1,3)]\r\n    restab <- (table(data$status, data$screen))\r\n    restab[2,1]\r\n  })\r\n  output$withoutdis <- renderText({\r\n    10000 - ((input$prev / 100) * 10000)\r\n  })\r\n  output$withdis <- renderText({\r\n    (input$prev / 100) * 10000\r\n  })\r\n  output$accuracy <- renderText({\r\n   ((input$sens * input$prev) + (input$spec * (100-input$prev))) / 100 \r\n  })\r\n}\r\nshinyApp(ui, server)","type":"text"}]
